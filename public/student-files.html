<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Files Browser - LearnToBot Class</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Mobile Styles */
        @import url('mobile.css');


        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #111827;
            min-height: 100vh;
            padding-top: 80px;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #1F2937 0%, #111827 100%);
            border-bottom: 2px solid #3B82F6;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 0 20px;
        }

        .navbar-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #E5E7EB;
            text-decoration: none;
            font-size: 1.5em;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .navbar-brand:hover {
            color: #3B82F6;
            transform: scale(1.05);
        }

        .navbar-logo {
            font-size: 1.8em;
        }

        .navbar-menu {
            display: flex;
            align-items: center;
            gap: 30px;
            list-style: none;
        }

        .navbar-link {
            color: #9CA3AF;
            text-decoration: none;
            font-weight: 600;
            font-size: 1em;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .navbar-link:hover {
            color: #3B82F6;
            background: rgba(59, 130, 246, 0.1);
        }

        .navbar-link.active {
            color: #3B82F6;
            background: rgba(59, 130, 246, 0.15);
        }

        .navbar-auth {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .navbar-btn {
            background: #3B82F6;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .navbar-btn:hover {
            background: #2563EB;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .page-content {
            padding: 20px;
        }

        .header {
            text-align: center;
            color: #E5E7EB;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            font-weight: 600;
        }

        .header p {
            font-size: 1.2em;
            color: #9CA3AF;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .search-section {
            background: #1F2937;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid #374151;
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            font-size: 1.1em;
            background: #111827;
            border: 2px solid #3B82F6;
            border-radius: 12px;
            color: #E5E7EB;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #60A5FA;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            color: #9CA3AF;
        }

        .folders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .folder-card {
            background: #1F2937;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #374151;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .folder-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
            border-color: #3B82F6;
        }

        .folder-icon {
            font-size: 3em;
            margin-bottom: 5px;
        }

        .folder-name {
            color: #E5E7EB;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .folder-info {
            color: #9CA3AF;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .folder-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: auto;
        }

        .folder-btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .folder-btn-primary {
            background: #10B981;
            color: white;
        }

        .folder-btn-primary:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .folder-btn-secondary {
            background: #3B82F6;
            color: white;
        }

        .folder-btn-secondary:hover {
            background: #2563EB;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #10B981;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            font-weight: 600;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            display: none;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .files-section {
            background: #1F2937;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid #374151;
            display: none;
        }

        .files-section.active {
            display: block;
        }

        .files-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3B82F6;
        }

        .files-title {
            font-size: 1.8em;
            color: #E5E7EB;
            font-weight: bold;
        }

        .back-btn {
            background: #6B7280;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #9CA3AF;
            transform: translateY(-2px);
        }

        .files-list {
            display: grid;
            gap: 15px;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 20px;
            background: #111827;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #374151;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
            border-color: #3B82F6;
        }

        .file-icon {
            font-size: 2.5em;
            min-width: 50px;
            text-align: center;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            color: #E5E7EB;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .file-meta {
            color: #9CA3AF;
            font-size: 0.9em;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: #6B7280;
            font-size: 1.2em;
        }

        .loading {
            text-align: center;
            color: #E5E7EB;
            font-size: 1.5em;
            padding: 50px;
        }

        .error {
            background: #DC2626;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid #EF4444;
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">
                <span class="navbar-logo">ü§ñ</span>
                <span>LearnToBot</span>
            </a>

            <ul class="navbar-menu">
                <li><a href="/" class="navbar-link">Projects</a></li>
                <li><a href="/student-progress.html" class="navbar-link">Student Progress</a></li>
                <li><a href="/teacher.html" class="navbar-link">Teacher Panel</a></li>
                <li><a href="/student-files.html" class="navbar-link active">My Files</a></li>
                <li><a href="/all-kids.html" class="navbar-link">All Kids</a></li>
                <li><a href="/test-page.html" class="navbar-link">Test Page</a></li>
            </ul>

            <div class="navbar-auth">
                <a href="/" class="navbar-btn">Back to Home</a>
            </div>
        </div>
    </nav>

    <div class="page-content">
        <div class="header">
            <h1>üìÅ Student Files Browser</h1>
            <p>Browse and access student project files</p>
        </div>

        <div class="container">
            <div class="search-section">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search for student name...">
                    <span class="search-icon">üîç</span>
                </div>
            </div>

            <div id="foldersContainer">
                <div class="loading">Loading student folders...</div>
            </div>

            <div id="filesSection" class="files-section">
                <div class="files-header">
                    <h2 class="files-title" id="folderTitle">Files</h2>
                    <button class="back-btn" onclick="goBackToFolders()">‚Üê Back to Folders</button>
                </div>
                <div id="filesContainer"></div>
            </div>
        </div>
    </div>

    <script>
        let allFolders = [];
        let currentFolder = null;

        // Load folders on page load
        async function loadFolders() {
            try {
                const response = await fetch('/api/student-folders');
                const data = await response.json();

                if (!data.success) {
                    showError(data.error || 'Failed to load folders');
                    return;
                }

                allFolders = data.folders;
                displayFolders(allFolders);
            } catch (error) {
                showError('Failed to load student folders: ' + error.message);
            }
        }

        // Display folders in grid
        function displayFolders(folders) {
            const container = document.getElementById('foldersContainer');

            if (folders.length === 0) {
                container.innerHTML = '<div class="no-results">No folders found</div>';
                return;
            }

            const html = `
                <div class="folders-grid">
                    ${folders.map(folder => `
                        <div class="folder-card">
                            <div class="folder-icon">üìÇ</div>
                            <div class="folder-name">${escapeHtml(folder.name)}</div>
                            <div class="folder-info">${folder.fileCount} file${folder.fileCount !== 1 ? 's' : ''}</div>
                            <div class="folder-actions">
                                <button class="folder-btn folder-btn-primary" onclick="copyFolderPath('${escapeHtml(folder.name)}')">
                                    üìã Open in Explorer
                                </button>
                                <button class="folder-btn folder-btn-secondary" onclick="openFolder('${escapeHtml(folder.name)}')">
                                    üëÅÔ∏è View Files
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            container.innerHTML = html;
        }

        // Search folders
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();

            if (searchTerm === '') {
                displayFolders(allFolders);
            } else {
                const filtered = allFolders.filter(folder =>
                    folder.name.toLowerCase().includes(searchTerm)
                );
                displayFolders(filtered);
            }
        });

        // Open a folder and show files
        async function openFolder(folderName) {
            try {
                currentFolder = folderName;
                const response = await fetch(`/api/student-folders/${encodeURIComponent(folderName)}/files`);
                const data = await response.json();

                if (!data.success) {
                    showError(data.error || 'Failed to load files');
                    return;
                }

                displayFiles(data.folderName, data.files);
            } catch (error) {
                showError('Failed to load files: ' + error.message);
            }
        }

        // Display files in folder
        function displayFiles(folderName, files) {
            document.getElementById('folderTitle').textContent = `üìÅ ${folderName}`;
            document.getElementById('filesSection').classList.add('active');
            document.getElementById('foldersContainer').style.display = 'none';
            document.querySelector('.search-section').style.display = 'none';

            const container = document.getElementById('filesContainer');

            if (files.length === 0) {
                container.innerHTML = '<div class="no-results">No files in this folder</div>';
                return;
            }

            const html = `
                <div class="files-list">
                    ${files.map(file => `
                        <div class="file-item" onclick="openFile('${escapeHtml(file.protocolUrl)}')">
                            <div class="file-icon">${getFileIcon(file.type)}</div>
                            <div class="file-info">
                                <div class="file-name">${escapeHtml(file.name)}</div>
                                <div class="file-meta">${file.sizeFormatted} ‚Ä¢ ${file.type}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            container.innerHTML = html;
        }

        // Open a file with default program using protocol handler
        function openFile(protocolUrl) {
            window.location.href = protocolUrl;
        }

        // Go back to folders view
        function goBackToFolders() {
            currentFolder = null;
            document.getElementById('filesSection').classList.remove('active');
            document.getElementById('foldersContainer').style.display = 'block';
            document.querySelector('.search-section').style.display = 'block';
        }

        // Get icon for file type
        function getFileIcon(type) {
            const icons = {
                'image': 'üñºÔ∏è',
                'pdf': 'üìÑ',
                'video': 'üé¨',
                'audio': 'üéµ',
                'text': 'üìù',
                'archive': 'üì¶',
                'document': 'üìã',
                'other': 'üìé'
            };
            return icons[type] || icons['other'];
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Show error message
        function showError(message) {
            const container = document.getElementById('foldersContainer');
            container.innerHTML = `<div class="error">${escapeHtml(message)}</div>`;
        }

        // Open folder in Windows Explorer using protocol handler
        async function copyFolderPath(folderName) {
            try {
                const response = await fetch(`/api/folder-path/${encodeURIComponent(folderName)}`);
                const data = await response.json();

                if (!data.success) {
                    showToast('Failed to get folder path', 'error');
                    return;
                }

                // Try to open with protocol first
                window.location.href = data.protocolUrl;

                // Show toast as fallback
                setTimeout(() => {
                    showToast(`Opening folder in Explorer...\n\nIf nothing happens, copy this path:\n${data.uncPath}`, 'success');
                }, 100);
            } catch (error) {
                console.error('Error opening folder:', error);
                showToast('Failed to open folder', 'error');
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            // Remove existing toast if any
            const existingToast = document.getElementById('toast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create new toast
            const toast = document.createElement('div');
            toast.id = 'toast';
            toast.className = 'toast show';
            toast.style.whiteSpace = 'pre-line';

            if (type === 'error') {
                toast.style.background = '#DC2626';
            }

            toast.textContent = message;
            document.body.appendChild(toast);

            // Auto-hide after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Load folders on page load
        loadFolders();
    </script>



    <script src="/socket.io/socket.io.js"></script>

    <script>

        // WebSocket connection for remote control

        const socket = io();



        socket.on('connect', () => {

            console.log('Connected to server via WebSocket');



            // Send student name if logged in

            const currentStudent = localStorage.getItem('currentStudent');

            if (currentStudent) {

                socket.emit('student-login', { studentName: currentStudent });

            }



            // Notify server of current page

            socket.emit('page-change', { page: 'Student Files Browser' });

        });



        // Listen for navigation commands from teacher

        socket.on('navigate', (data) => {

            console.log('Navigation command received:', data.url);

            window.location.href = data.url;

        });

    </script>

    <footer>

        <p>Last Updated: <span id="last-updated"></span></p>

    </footer>

    <style>
        footer {

            text-align: center;

            padding: 1rem;

            margin-top: 2rem;

            font-size: 0.9em;

            color: #6c757d;

        }
    </style>

    <script>

        document.addEventListener('DOMContentLoaded', function () {

            const lastUpdatedElement = document.getElementById('last-updated');

            if (lastUpdatedElement) {

                const now = new Date();

                lastUpdatedElement.textContent = now.toLocaleString();

            }

        });

    </script>

</body>

</html>